@model WebWinMVC.Models.JRZLWTViewModel

@{
    ViewData["Title"] = "SIL";
    ViewBag.Username = @Context.Session.GetString("Username");
    ViewBag.Name = @Context.Session.GetString("Name");
    ViewBag.Role = @Context.Session.GetString("Role");
    ViewBag.Group = @Context.Session.GetString("Group");
    ViewBag.Phone = @Context.Session.GetString("Phone");
    ViewBag.IsLoggedIn = true;
}

<div class="text-center" style="background-color: #5F9EA0; padding: 3vh;width: 100%; height: 8vh; display: flex; align-items: center; justify-content: center;">
    <h1 class="display-4" style="color: white; margin: 0;">SIL管理系统</h1>
</div>


<div>
    <div class="row no-gutters" style="margin: auto;">
        <!-- 左侧菜单 -->
        <div class="col-md-2 col-lg-2" style="height: 100vh; background-color: #343a40;">
            <ul class="list-group">
                <!-- 系统首页 -->
                <li class="list-group-item text-white text-center" style="background-color: transparent; padding: 0; margin: 3vh 0 0 0; border-color: transparent; font-size: 1rem; position: relative;">
                    系统首页
                </li>

                <!-- 系统管理 -->
                <li class="list-group-item text-white text-center" style="background-color: transparent; padding: 0; margin: 3vh 0 0 0; border-color: transparent; font-size: 1rem; position: relative;">
                    <a style="color: white; font-size: 1rem; text-decoration: none;" data-bs-toggle="collapse" href="#collapseSysAdmin" role="button" aria-expanded="false" aria-controls="collapseSysAdmin">
                        系统管理
                    </a>
                    <span class="toggle-icon" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);">+</span>
                    <div class="collapse" id="collapseSysAdmin">
                        <div class="card card-body" style="background-color: transparent; border-color: transparent; color: white;">
                            角色管理<br>
                            用户管理<br>
                            新产品通知维护<br>
                            故障模式通知维护
                        </div>
                    </div>
                </li>

                <!-- 质量管理 -->
                <li class="list-group-item text-white text-center" style="background-color: transparent; padding: 0; margin: 3vh 0 0 0; border-color: transparent; font-size: 1rem; position: relative;">
                    <a style="color: white; font-size: 1rem; text-decoration: none;" data-bs-toggle="collapse" href="#collapseQuality" role="button" aria-expanded="false" aria-controls="collapseQuality">
                        质量管理
                    </a>
                    <span class="toggle-icon" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);">+</span>
                    <div class="collapse" id="collapseQuality">
                        <div class="card card-body" style="background-color: transparent; border-color: transparent; color: white;">
                            通知维护<br>
                            通知查询<br>
                            旧件通知
                        </div>
                    </div>
                </li>

                <!-- 项目管理 -->
                <li class="list-group-item text-white text-center" style="background-color: transparent; padding: 0; margin: 3vh 0 0 0; border-color: transparent; font-size: 1rem; position: relative;">
                    <a style="color: white; font-size: 1rem; text-decoration: none;" data-bs-toggle="collapse" href="#collapseProject" role="button" aria-expanded="false" aria-controls="collapseProject">
                        项目管理
                    </a>
                    <span class="toggle-icon" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);">+</span>
                    <div class="collapse" id="collapseProject">
                        <div class="card card-body" style="background-color: transparent; border-color: transparent; color: white;">
                            通知确认<br>
                            项目维护<br>
                            项目步骤<br>
                            项目查询
                        </div>
                    </div>
                </li>

                <!-- 报表导出 -->
                <li class="list-group-item text-white text-center" style="background-color: transparent; padding: 0; margin: 3vh 0 0 0; border-color: transparent; font-size: 1rem; position: relative;">
                    <a style="color: white; font-size: 1rem; text-decoration: none;" data-bs-toggle="collapse" href="#collapseReport" role="button" aria-expanded="false" aria-controls="collapseReport">
                        报表导出
                    </a>
                    <span class="toggle-icon" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);">+</span>
                    <div class="collapse" id="collapseReport">
                        <div class="card card-body" style="background-color: transparent; border-color: transparent; color: white;">
                            项目报表<br>
                            通知报表
                        </div>
                    </div>
                </li>
            </ul>
        </div>

        <!-- 右侧内容 -->
        <div class="col-md-10 col-lg-10">
            <div class="row" style="height: 5vh;"></div>

            <div class="search-container mb-4">
                <div class="row">
                    <div class="col-md-3">
                        <input type="text" class="form-control" placeholder="部位码">
                    </div>
                    <div class="col-md-3">
                        <input type="text" class="form-control" placeholder="故障码">
                    </div>
                    <div class="col-md-3">
                        <input type="text" class="form-control" placeholder="项目">
                    </div>
                    <div class="col-md-3">
                        <input type="text" class="form-control" placeholder="状态">
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-md-3">
                        <input type="text" class="form-control" placeholder="管理人">
                    </div>
                    <div class="col-md-3">
                        <input type="text" class="form-control" placeholder="失效零件">
                    </div>
                    <div class="col-md-3">
                        <input type="text" class="form-control" placeholder="待处理人">
                    </div>
                    <div class="col-md-3">
                        <input type="text" class="form-control" placeholder="创建时间">
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="d-flex justify-content-center  align-items-center">
                    <div style="padding: 2vh 0;">
                        <div class="btn-group" role="group">
                            <button type="button" id="basicInfoButton" class="btn btn-outline-secondary mx-5" style="width: 100%;" data-bs-toggle="modal" data-bs-target="#infoModal">基本信息</button>
                            <button type="button" class="btn btn-success mx-5" style="width: 100%;">责任人</button>
                            <button type="button" class="btn btn-warning mx-5" style="width: 100%;">项目计划</button>
                            <button type="button" class="btn btn-warning mx-5" style="width: 100%;">阶段计划</button>
                            <button type="button" class="btn btn-danger mx-5" style="width: 100%;">强制关闭</button>
                            <button type="button" class="btn btn-info mx-5" style="width: 100%;">阶段提交</button>
                            <button type="button" class="btn btn-info mx-5" style="width: 100%;">项目驳回</button>
                            <button type="button" class="btn btn-danger mx-5" style="width: 100%;">项目总结</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="custom-container">
                <div class="row">
                    <div class="d-flex justify-content-center">
                        <table id="projectTableSIL" class="table table-bordered table-striped" style="overflow: auto;">
                            <thead>
                                <tr>
                                    <th>
                                        <input type="checkbox" id="selectAll">
                                    </th>
                                    <th>项目编码</th>
                                    <th>项目名称</th>
                                    <th>通知单</th>
                                    <th>状态</th>
                                    <th>报警状态</th>
                                    <th>阶段状态</th>
                                    <th>部位码</th>
                                    <th>失效零件</th>
                                    <th>责任人</th>
                                    <th>责任部门</th>
                                    <th>管理人</th>
                                    <th>创建人</th>
                                    <th>开始时间</th>
                                    <th>TTF</th>
                                    <th>待处理人</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.SILSimulationTables)
                                {
                                    <tr data-fault-code="@item.FaultCode"
                                        data-fault-description="@item.FaultDescription"
                                        data-old-material-code="@item.OldMaterialCode"
                                        data-reporter="@item.Reporter"
                                        data-reporter-phone="@item.ReporterPhone"
                                        data-initial-fault-analysis="@item.InitialFaultAnalysis"
                                        data-repair-process-and-effect="@item.RepairProcessAndEffect"
                                        data-inspector="@item.Inspector"
                                        data-inspector-phone="@item.InspectorPhone"
                                        data-repair-time="@item.RepairTime"
                                        data-van="@item.VAN"
                                        data-chassis-number="@item.ChassisNumber"
                                        data-vehicle-model="@item.VehicleModel"
                                        data-purchase-time="@item.PurchaseTime"
                                        data-fault-time="@item.FaultTime"
                                        data-vehicle-status="@item.VehicleStatus"
                                        data-preventive-measures="@item.PreventiveMeasures"
                                        data-project-type="@item.ProjectType"
                                        data-province="@item.Province"
                                        data-city="@item.City"
                                        data-location-code-description="@item.LocationCodeDescription"
                                        data-old-material-code-description="@item.OldMaterialCodeDescription"
                                        data-fault-code-description="@item.FaultCodeDescription">

                                        <td>
                                            <input type="checkbox" class="rowSelect">
                                        </td>
                                        <td>
                                            <button class="btn btn-link p-0" onclick="showPQSModal(this)">@item.PSQNumber</button>
                                        </td>
                                        <td>
                                            <div style="text-overflow: ellipsis;" title="@item.Title">
                                                @item.Title
                                            </div>
                                        </td>
                                        <td>
                                            <button class="btn btn-link p-0" onclick="showNotificationModal(this)">@item.NotificationNumber</button>
                                        </td>
                                        <td>@item.Status</td>
                                        <td>@item.FaultLevel</td>
                                        <td>@item.StageStatus</td>
                                        <td>@item.LocationCode</td>
                                        <td>@item.FailurePartCount</td>
                                        <td>@item.ResponsiblePerson</td>
                                        <td>@item.ResponsibleDepartment</td>
                                        <td>@item.Manager</td>
                                        <td>@item.Creator</td>
                                        <td>@item.StartTime</td>
                                        <td>@item.TTF</td>
                                        <td>@item.PendingPerson</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



            @section Scripts {
                <script>
                    $(document).ready(function () {
                        $('#project-menu').on('show.bs.collapse', function () {
                            $(this).prev().find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up");
                        }).on('hide.bs.collapse', function () {
                            $(this).prev().find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down");
                        });

                        $('#selectAll').change(function () {
                            $('.rowSelect').prop('checked', this.checked);
                        });

                        $('.collapse').on('show.bs.collapse', function () {
                            $(this).siblings('span.toggle-icon').text('-'); // 显示减号
                        }).on('hide.bs.collapse', function () {
                            $(this).siblings('span.toggle-icon').text('+'); // 显示加号
                        });
                    });
                    document.querySelector('.custom-container .table tbody').addEventListener('scroll', function () {
                        const thead = document.querySelector('.custom-container .table thead');
                        thead.scrollLeft = this.scrollLeft;

                    });
                </script>
                <script>

                    $(document).ready(function () {
                        $('#selectAll').change(function () {
                            $('.rowSelect').prop('checked', this.checked);
                        });

                        $('#basicInfoButton').click(function () {
                            const checkedCheckboxes = $('.rowSelect:checked');

                            // 确保只选中一行
                            if (checkedCheckboxes.length === 1) {
                                const $row = checkedCheckboxes.closest('tr'); // 获取当前行

                                // 从当前行的 data-* 属性中获取值
                                const faultDescription = $row.data('fault-description') || "NIL";
                                const preventiveMeasures = $row.data('preventive-measures') || "NIL";
                                const repairProcessAndEffect = $row.data('repair-process-and-effect') || "NIL";

                                // 更新模态框中的文本框
                                $('#faultDescription').val(faultDescription);
                                $('#mitigationMeasures').val(preventiveMeasures);
                                $('#repairProcess').val(repairProcessAndEffect);

                                // 显示模态框
                                $('#infoModal').modal('show');
                            } else {
                                alert("请只选中一行进行查看。"); // 提示用户
                                // 这里不需要关闭模态框，因为它不会被打开
                                return; // 终止后续代码执行
                            }
                        });

                        // 关闭模态框时重置输入框（可选）
                        $('#infoModal').on('hidden.bs.modal', function () {
                            $('#faultDescription').val('');
                            $('#mitigationMeasures').val('');
                            $('#repairProcess').val('');
                        });
                    });


                </script> @* 获取立项数据库信息 *@
                <script>
                    function showNotificationModal(button) {
                        const $row = $(button).closest('tr');

                        // 从当前行的 data-* 属性中获取值
                        const van = $row.data('van');
                        const chassisNumber = $row.data('chassis-number');
                        const vehicleModel = $row.data('vehicle-model');
                        const purchaseTime = $row.data('purchase-time');
                        const faultTime = $row.data('fault-time');
                        const vehicleStatus = $row.data('vehicle-status');
                        const preventiveMeasures = $row.data('preventive-measures');
                        const projectType = $row.data('project-type');

                        // 更新模态框中的文本框
                        $('#vanInfo').val(van);
                        $('#chassisNumberInfo').val(chassisNumber);
                        $('#vehicleModelInfo').val(vehicleModel);
                        $('#purchaseTimeInfo').val(purchaseTime);
                        $('#faultTimeInfo').val(faultTime);
                        $('#vehicleStatusInfo').val(vehicleStatus);
                        $('#preventiveMeasuresInfo').val(preventiveMeasures);
                        $('#projectTypeInfo').val(projectType);

                        // 显示模态框
                        $('#notificationModal').modal('show');
                    }

                    function showPQSModal(button) {
                        const $row = $(button).closest('tr');

                        // 从当前行的 data-* 属性中获取值
                        const reporter = $row.data('reporter');
                        const reporterPhone = $row.data('reporter-phone');
                        const initialFaultAnalysis = $row.data('initial-fault-analysis');
                        const repairProcessAndEffect = $row.data('repair-process-and-effect');
                        const inspector = $row.data('inspector');
                        const inspectorPhone = $row.data('inspector-phone');
                        const repairTime = $row.data('repair-time');

                        // 更新模态框中的文本框
                        $('#reporterInfo').val(reporter);
                        $('#reporterPhoneInfo').val(reporterPhone);
                        $('#initialFaultAnalysisInfo').val(initialFaultAnalysis);
                        $('#repairProcessInfo').val(repairProcessAndEffect);
                        $('#inspectorInfo').val(inspector);
                        $('#inspectorPhoneInfo').val(inspectorPhone);
                        $('#repairTimeInfo').val(repairTime);

                        // 显示模态框
                        $('#pqsModal').modal('show');
                    }
                </script>


            }
